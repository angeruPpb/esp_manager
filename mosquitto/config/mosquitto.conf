# ========== PERSISTENCIA ==========
# Habilitar persistencia en disco
persistence true
persistence_location /mosquitto/data/

# Guardar estado cada 5 minutos (300 segundos)
autosave_interval 300

# ========== GESTIÓN DE MENSAJES ==========
# Cola máxima por cliente (1000 mensajes)
max_queued_messages 1000

# Mensajes sin ACK simultáneos (20)
max_inflight_messages 20

# Expira clientes offline después de 1 hora
persistent_client_expiration 1h

# ========== LOGS ==========
# Tipos de log: error, warning, notice, information, all
log_type all

# Destino de logs
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout

# Log de timestamp
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# ========== SEGURIDAD ==========
# Puerto MQTT
listener 1883
protocol mqtt

# Deshabilitar acceso anónimo
allow_anonymous false

# Archivo de contraseñas
password_file /mosquitto/config/passwd

# ========== WEBSOCKET (OPCIONAL) ==========
listener 9001
protocol websockets

# ========== LÍMITES DE CONEXIÓN ==========
# Máximo de conexiones simultáneas
max_connections -1

# Tiempo de keepalive por defecto (60 segundos)
# max_keepalive 60

# ========== CALIDAD DE SERVICIO ==========
# Permitir QoS 0, 1 y 2
# max_qos 2

# Upgrade QoS 0 a QoS 1 automáticamente (opcional)
# upgrade_outgoing_qos false